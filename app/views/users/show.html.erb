<%= stylesheet_link_tag 'user_show', media: 'all' %>

<div id="title" class="user_show">
  <div class="slogans">
		<div class="slogan">
		  My Account
		</div>
		<div class="secondary-slogan">
			マイページ
		</div>
	</div>
</div>


<div class="content">
  <div class="container">
    <%= render 'layouts/flash_messages' %>
    <div class="row">
      <div class="myinfo">
        <div class="col-sm-4 col-sm-offset-2">
          <div class="text-center">
            <img class="img-circle circular-img" src="<%= gravatar_url(@user, { size: 180 }) %>">
      	  	<h4 class="myinfo-head"><%= current_user.name %></h4>
      	  </div>
    	  	<ul>
          <li>
            <strong>メールアドレス：</strong>
            <%= current_user.email %>
          </li>
          <li>
            <strong>使用楽器：</strong>
            <%= @instruments.pluck(:ins_name_ja).join('、') %>
          </li>
          <li>
            <strong>気になる分野：</strong>
            <%= @subjects.pluck(:subj_name_ja).join('、') %>
          </li>
          <li>
            <strong>使用言語：</strong>
            <%= @languages.pluck(:lang_name).join('、') %>
          </li>
        </ul>
    	  </div>
    	  <div class="col-sm-4">
    	    <h4>保有ポイント：</h4>
    	    <div class="text-center">
    	      <% if @point %>
      	      <span class="number"><%= @point.current_point %></span>   P
            <% else %>
              <span class="number">0</span>   P
            <% end %>
          </div>
  	      <div class="point-buttons text-center">
  	        <%= link_to 'ポイント履歴確認', point_histories_path, class: 'btn btn-success point-history' %>
  	        <%= link_to 'ポイント出金依頼', new_withdraw_path, class: 'btn btn-o withdraw' %>
  	      </div>
  	      <div class="purchase">
        	  <%= form_tag(action: :purchase, controller: :point_histories, method: :post) do %>
          	  <%= label_tag :price, 'ポイント購入', class:'mini-title' %><br />
              <div class="text-center">
                <%= select_tag :price, options_for_select([['3,000ポイント(3,000円)', 3000], ['5,000ポイント(5,000円)', 5000], ['10,000ポイント(10,000円)', 10000],]) %>
                <script class="payjp-button" data-key="<%= ENV['PAYJP_PUBLIC_KEY'] %>" src="https://checkout.pay.jp" type="text/javascript" data-text="クレジット支払い"></script>
              </div>
            <% end %>
  	      </div>
    	  </div>
    	</div>
    </div>
    
    <div class="row menu text-center">
      <!--<div class="col-sm-2 col-sm-offset-3 col-xs-4">-->
      <!--  <a href="#">-->
      <!--    <i class="fa fa-search"></i>-->
      <!--  </a>-->
      <!--</div>-->
      <div class="col-sm-2  col-sm-offset-4 col-xs-4">
        <%= link_to edit_user_path(current_user) do %>
          <i class="fa fa-edit"></i>
        <% end %>
      </div>
      <div class="col-sm-2 col-xs-4">
        <%= link_to messages_path do %>
          <i class="fa fa-envelope"></i>
        <% end %>
      </div>
    </div>


    <% if @user.lesson %>
      <div class="row">
        <div class="col-lg-12">
          <h3>&nbsp;&nbsp;開催中のレッスン</h3>
        </div>
        <% @user.lesson.lesson_plans.each.with_index(1) do |plan, index| %>
          <div class="col-sm-4 col-md-3">
            <div class="panel panel-default">
              <div class="panel-heading text-center">
                <h4 class="panel-title">レッスンプラン <%= index %></h4>
              </div>
              <div class="panel-body">
                <ul>
                  <% if plan.location_narrow.blank? %>
                    <li>場所： <%= plan.location_broad %></li>
                  <% else %>
                    <li>場所： <%= plan.location_broad %>  ( <%= plan.location_narrow %> )</li>
                  <% end %>
                  <li>時間： <%= plan.minute %> 分</li>
                  <li>料金： <%= plan.price_yen.to_s(:delimited) %> 円</li>
                </ul>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="text-center lesson-button">
        <%= link_to @user.lesson, class:'btn btn-default' do %>
          <i class="fa fa-paperclip"></i> レッスン詳細
        <% end %>
        <%= link_to edit_lesson_path(@user.lesson), class:'btn btn-default' do %>
          <i class="fa fa-edit"></i> レッスン編集
        <% end %>
      </div>
    <% else %>
      <div class="text-center lesson-button">
        <%= link_to 'レッスンを開催する', new_lesson_path, class:'btn btn-default'  %>
      </div>
    <% end %>
  </div>
</div>